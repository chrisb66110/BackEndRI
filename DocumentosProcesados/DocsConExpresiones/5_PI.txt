 c fundamentos de programaci punteros inteligentes c fundamentos de programaci t modernas y aplicaciones actuales del lenguaje c fundamentos de programaci punteros inteligentes sem ntica de propiedad exclusiva la plantilla de clase std unique implementa una sem ntica de propiedad exclusiva del objeto referenciado concretamente un objeto u de tipo std unique almacena un puntero miembro a un segundo objeto de tipo t o derivado sobre el que se sigue una determinada pol de destrucci por el cuando u es destruido la sem ntica de propiedad exclusiva implica que el puntero inteligente u no pueda copiarse pues de poder hacerlo acabar con dos referencias al mismo objeto existe sin embargo un mecanismo de transferencia de la propiedad que analizaremos en este post el est ndar del lenguaje define la siguiente plantilla biparam para objetos simples namespace std typename t class d default class unique el segundo par metro determina la pol de destrucci a seguir con el objeto referenciado al finalizar el tiempo de vida del puntero inteligente la pol adoptada por defecto implementada por la clase std default invoca al operador delete sobre el puntero miembro namespace std typename struct default default noexcept default template typename default default const noexcept void const if t is an incomplete type the program is ill formed static 0 delete pointer to incomplete delete p de ser necesario el uso expl de punteros la plantilla std unique se considera la opci por defecto para la asignaci din mica de memoria de forma segura ante excepciones a modo de ejemplo consideremos el c siguiente class complex double re im public re 0 0 double im 0 noexcept re im double const noexcept return re noexcept return re double const noexcept return im noexcept return im int std unique 0 4 complex c u 2 0 don t do this auto v u error auto v std ok execution continues v 7 0 don t do this u 1 0 undefined behavior en se inicializa una variable autom tica de tipo std unique que almacena como dato miembro un puntero a un objeto de tipo complex parte real 3 0 e imaginaria 4 almacenado din micamente las operaciones de observaci propias de los punteros ordinarios se encuentran habilitadas para std unique gracias a la sobrecarga de operadores as en el operador de indirecci permite acceder al objeto referenciado por u y realizar una copia del mismo en una nueva variable autom tica c de tipo complex en se invoca a la funci miembro a trav del operador de desreferencia para asignar un nuevo valor a la parte real del n complejo referenciado por u con el fin de dar efecto a la sem ntica de propiedad exclusiva std unique posee un constructor copia y un operador de asignaci copia declarados delete por lo que tales operaciones se encuentran deshabilitadas de ah que se produzca un error de compilaci de intentarse una inicializaci como en namespace std typename t class d default class unique public unique is neither copyconstructible nor copyassignable unique delete unique operator delete unique is both moveconstructible and moveassignable unique noexcept unique operator noexcept sin embargo la plantilla de clase std unique implementa la sem ntica de movimiento de modo que la propiedad del objeto referenciado puede ser transferida a un nuevo puntero inteligente v de tipo std unique de manera expl como en sin m s que utilizar la funci std definida en el fichero de cabecera al hacerlo el puntero miembro de u es reseteado a nullptr tal y como se comprueba en a partir de pues el puntero v es el responsable del objeto complex creado al principio del programa pudiendo realizar operaciones sobre como en el puntero u si bien vac sigue disponible para una eventual reasignaci eso s cualquier desreferencia del mismo en dicho estado como en dar lugar a un comportamiento indefinido de acuerdo con el est ndar del lenguaje en tanto u como v salen fuera de mbito invoc ndose autom ticamente al operador delete sobre sus punteros miembro esta operaci no tiene ning efecto en u al ser su puntero miembro nulo en el caso de v sin embargo el objeto por apuntado es destruido y su memoria liberada se recomienda con el fin de obtener un c seguro y robusto evitar el uso expl no encapsulado de los operadores new delete es por ello que el nuevo est ndar del lenguaje c proporciona la plantilla de funci std make namespace std typename t typename unique make return unique crea un objeto std unique para un tipo t no matricial pasando los argumentos args al constructor de t as la l de c en el ejemplo anterior puede ser sustituida por la expresi auto u std make 0 4 note u is of type std unique publicado por daniel g vergel en domingo marzo 01 2015 enviar por correo electr escribe un blog compartir con twitter compartir con facebook compartir en pinterest no hay comentarios publicar un comentario entrada m s reciente entrada antigua p gina principal suscribirse a enviar comentarios acerca del blog este blog est especialmente dirigido a estudiantes y profesores de ciencias de la computaci interesados en la gesti eficiente de los recursos de sus sistemas mediante t modernas de programaci en el lenguaje c buscar en el blog art publicados 2016 noviembre octubre julio mayo abril 2015 julio junio mayo abril marzo punteros inteligentes punteros inteligentes punteros inteligentes febrero enero entrada destacada sem nticas de copia y movimiento sobre el autor daniel g vergel soy licenciado en f por la universidad de sevilla y doctor en f te por la universidad complutense de madrid mi inter por distintas ramas de la f me ha permitido ocupar puestos de investigaci en reas de muy diversa naturaleza at caracterizaci de materiales gravedad cu en centros de reconocido prestigio durante los diez a colaborando con equipos experimentales y te tanto en espa nacional de aceleradores y centro superior de investigaciones cient entre como en el extranjero de utrecht y universidad t de y ello con la labor docente como referente permanente pues la he considerado siempre como la mejor forma en base a mis aptitudes de contribuir a la mejora de la sociedad y a la mejor formaci de nuestros profesionales en la actualidad formo parte del equipo docente del departamento de ciencias y tecnolog de la universidad europea e imparto clases magistrales de asignaturas de f matem ticas y programaci enfocadas a diversos grados acad ver todo mi perfil todos los derechos reservados daniel g vergel 2015 2016 tema sencillo con la tecnolog de blogger 